<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    {% load static %}
    <title>Edit Profile</title>

    <link rel="shortcut icon" href="{% static 'assets/images/logo/hope.png' %}" type="image/x-icon">
    <link rel="stylesheet" href="{% static 'assets/css/animate-3.7.0.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/font-awesome-4.7.0.min.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/bootstrap-4.1.3.min.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/owl-carousel.min.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/jquery.datetimepicker.min.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/style.css' %}">
    <style>
      .toggle-link { cursor: pointer; text-decoration: underline; }
      .card { border: 0; box-shadow: 0 8px 24px rgba(0,0,0,.08); }
      .d-none { display: none !important; }
      .form-label { font-weight: 600; }
    </style>
</head>
<body>
    <!-- Preloader -->
    <div class="preloader"><div class="spinner"></div></div>

    <!-- Header -->
    <header class="header-area header-area2">
        <div class="container">
            <div class="row">
                <div class="col-lg-2">
                    <div class="logo-area">
                        <a href="{% url 'home' %}" style="color: white; font-size: 20px;">
                            <img src="{% static 'assets/images/logo/hope.png' %}" alt="HopeMeals logo">HopeMeals
                        </a>
                    </div>
                </div>
                <div class="col-lg-10">
                    <div class="custom-navbar"><span></span><span></span><span></span></div>
                    <div class="main-menu main-menu2">
                        <ul>
                            <li><a href="{% url 'home' %}">Home</a></li>
                            <li><a href="{% url 'help' %}">Contact</a></li>
                            <li><a href="{% url 'chatbot' %}">Chatbot</a></li>
                            <li><a href="{% url 'logout' %}">Logout</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Banner -->
    <section class="banner-area banner-area2 text-center">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <h1><i>Edit Profile</i></h1>
                    <p class="pt-2"><i>Update your basic details or change your password â€” all in one place.</i></p>
                </div>
            </div>
        </div>
    </section>

    <!-- Content -->
    <section class="welcome-area">
        <div class="container">
            <!-- Flash messages (Django messages framework) -->
            {% if messages %}
              <div class="row">
                <div class="col-lg-8 mx-auto">
                  {% for message in messages %}
                    <div class="alert alert-{{ message.tags }} mb-2" role="alert">{{ message }}</div>
                  {% endfor %}
                </div>
              </div>
            {% endif %}

            <div class="row justify-content-center">
                <div class="col-lg-8">
                    <div class="card p-4 p-md-5">
                        <!-- BASIC DETAILS FORM -->
                        <div id="basic-section">
                            <h3 class="mb-3">Hi {{user.username}}</h3>
                            <p class="text-muted mb-4">These are your current details. Edit and save to update.</p>
                            <form method="post" action="" novalidate>
                                {% csrf_token %}
                                <input type="hidden" name="action" value="update_profile">
                                <div class="form-group">
                                    <label class="form-label" for="name">Name</label>
                                    <input id="name" name="name" type="text" class="form-control"
                                           value="{{ user.get_full_name|default:user.username }}">
                                </div>
                                <div class="form-group">
                                    <label class="form-label" for="email">Email</label>
                                    <input id="email" name="email" type="email" class="form-control"
                                           value="{{ user.email }}">
                                </div>
                                <div class="form-group">
                                    <label class="form-label" for="phone">Phone number</label>
                                    <input id="phone" name="phone" type="tel" class="form-control"
                                           value="{{ user.profile.phone|default_if_none:'' }}">
                                </div>
                                <div class="d-flex align-items-center gap-3 mt-3">
                                    <button type="submit" class="template-btn">Save changes</button>
                                    <a id="show-password" class="toggle-link ml-3">Change password</a>
                                </div>
                            </form>
                        </div>

                        <!-- PASSWORD CHANGE FORM (hidden by default) -->
                        <div id="password-section" class="d-none">
                            <h3 class="mb-3">Change password</h3>
                            <p class="text-muted mb-4">Enter your current password and choose a new one.</p>
                            <form method="post" action="" novalidate>
                                {% csrf_token %}
                                <input type="hidden" name="action" value="change_password">
                                <div class="form-group">
                                    <label class="form-label" for="old_password">Current password</label>
                                    <input id="old_password" name="old_password" type="password" class="form-control" required autocomplete="current-password">
                                </div>
                                <div class="form-group">
                                    <label class="form-label" for="new_password1">New password</label>
                                    <input id="new_password1" name="new_password1" type="password" class="form-control" required autocomplete="new-password">
                                </div>
                                <div class="form-group">
                                    <label class="form-label" for="new_password2">Confirm new password</label>
                                    <input id="new_password2" name="new_password2" type="password" class="form-control" required autocomplete="new-password">
                                </div>
                                <div class="d-flex align-items-center gap-3 mt-3">
                                    <button type="submit" class="template-btn">Update password</button>
                                    <a id="back-to-details" class="toggle-link ml-3">Back to details</a>
                                </div>
                            </form>
                        </div>
                        <!-- /sections -->
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer-area">
        <div class="footer-widget footer-widget2 section-padding">
            <div class="container">
                <div class="row">
                    <div class="col-md-6">
                        <div class="single-widget single-widget1">
                            <a href="{% url 'home' %}"><img src="{% static 'assets/images/logo/hope.png' %}" alt=""></a>
                            <p class="mt-3">Fighting food waste and hunger through a simple, impactful platform. Join us today to make a difference in the world!</p>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="single-widget single-widget2 my-5 my-md-0">
                            <h5 class="mb-4">Contact Us</h5>
                            <div class="d-flex">
                                <div class="into-icon"><i class="fa fa-map-marker"></i></div>
                                <div class="info-text">
                                    <p><a href="https://maps.app.goo.gl/CRs4PLRPf6FxuDn98" target="_blank" rel="noopener noreferrer" style="color:gray;">Vidya Vikas Institute of Engineering & Technology</a></p>
                                </div>
                            </div>
                            <div class="d-flex">
                                <div class="into-icon"><i class="fa fa-phone"></i></div>
                                <div class="info-text">
                                    <p><a href="tel:+918431533398" style="color: gray;">+918431533398</a></p>
                                </div>
                            </div>
                            <div class="d-flex">
                                <div class="into-icon"><i class="fa fa-envelope-o"></i></div>
                                <div class="info-text">
                                    <p><a href="mailto:support@HopeMeals.com" style="color: gray;">support@HopeMeals.com</a></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="footer-copyright footer-copyright2">
            <div class="container">
                <div class="row">
                    <div class="col-lg-7 col-md-6">
                        <span>&copy; <script>document.write(new Date().getFullYear());</script> All rights reserved | HopeMeals</span>
                    </div>
                    <div class="col-lg-5 col-md-6">
                        <div class="social-icons">
                            <ul>
                                <li><a href="#"><i class="fa fa-facebook"></i></a></li>
                                <li><a href="#"><i class="fa fa-twitter"></i></a></li>
                                <li><a href="#"><i class="fa fa-google-plus"></i></a></li>
                                <li><a href="#"><i class="fa fa-pinterest"></i></a></li>
                                <li><a href="#"><i class="fa fa-instagram"></i></a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </footer>

    <!-- JS -->
    <script src="{% static 'assets/js/vendor/jquery-2.2.4.min.js' %}"></script>
    <script src="{% static 'assets/js/vendor/bootstrap-4.1.3.min.js' %}"></script>
    <script src="{% static 'assets/js/vendor/wow.min.js' %}"></script>
    <script src="{% static 'assets/js/vendor/owl-carousel.min.js' %}"></script>
    <script src="{% static 'assets/js/vendor/jquery.datetimepicker.full.min.js' %}"></script>
    <script src="{% static 'assets/js/vendor/jquery.nice-select.min.js' %}"></script>
    <script src="{% static 'assets/js/main.js' %}"></script>

    <script>
      (function () {
        var basic = document.getElementById('basic-section');
        var pwd   = document.getElementById('password-section');
        var showPwd = document.getElementById('show-password');
        var back  = document.getElementById('back-to-details');

        function showPasswordPanel(e){
          if(e) e.preventDefault();
          basic.classList.add('d-none');
          pwd.classList.remove('d-none');
          // focus first field for accessibility
          var first = document.getElementById('old_password');
          if(first) first.focus();
        }
        function showBasicPanel(e){
          if(e) e.preventDefault();
          pwd.classList.add('d-none');
          basic.classList.remove('d-none');
          var first = document.getElementById('name');
          if(first) first.focus();
        }

        if (showPwd) showPwd.addEventListener('click', showPasswordPanel);
        if (back) back.addEventListener('click', showBasicPanel);

        // Optional: flip back to details if backend re-renders with a success flag
        {% if request.POST.action == 'change_password' and form_password and form_password.errors %}
          showPasswordPanel();
        {% endif %}
      })();
    </script>
</body>
</html>
